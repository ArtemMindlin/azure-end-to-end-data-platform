# Azure End-to-End Data Platform (ADF + Blob + Azure SQL)

End-to-end data platform built on **Microsoft Azure**, covering ingestion, storage, transformation, and analytical persistence.  
This project demonstrates how to design and implement a **production-style, cloud-native data architecture** using managed Azure services and real-world scraped product data.

The solution mirrors patterns commonly used in **enterprise analytics and data engineering teams**, including layered storage, staging areas, idempotent loads, and historical snapshots.

---

## Architecture Overview

The platform follows a **layered data architecture**, combining a data lake and a relational analytical store.

### High-level flow

Raw (Blob) → Curated (Blob) → Staging (Azure SQL) → Current & History tables (Azure SQL)

---

## Data Layers

### Raw (Bronze) – Azure Blob Storage
- Stores data **exactly as ingested**
- Immutable, append-only
- Acts as the system of record
- No transformations applied

### Curated (Silver) – Azure Blob Storage
- Cleaned and standardized datasets
- Column names normalized (e.g. lowercase, snake_case)
- Data types prepared for relational storage
- Ingestion metadata added
- Optimized for downstream analytics

> Curated outputs may consist of multiple partition files generated by Spark-based Data Flows.  
> A human-readable consolidated CSV is also produced for inspection and debugging.

### Staging – Azure SQL Database (`stg` schema)
- Temporary relational landing area
- Schema aligned with curated data
- Minimal constraints (no primary keys)
- Used to:
  - Decouple ingestion from analytics logic
  - Absorb schema changes safely
  - Enable controlled transformations in SQL

### Analytics Layer – Azure SQL Database (`dbo` schema)

#### `dbo.products_current`
- Contains the **latest snapshot** of each product
- One row per product (`id` as primary key)
- Fully typed columns (DECIMAL, DATETIME2, NVARCHAR)
- Updated using idempotent `MERGE` logic

#### `dbo.products_history`
- Stores **historical snapshots** of product prices and attributes
- Supports temporal analysis (price evolution over time)
- Multiple rows per product, one per snapshot date

---

## Azure Services Used

- **Azure Blob Storage**
  - Acts as the data lake
  - Logical separation between raw and curated layers

- **Azure Data Factory**
  - Orchestrates ingestion, transformation, and loading
  - Implements conditional logic and failure handling
  - Executes Data Flows, Copy Activities, and Stored Procedures

- **Azure SQL Database**
  - Relational analytical store
  - Staging, current, and historical tables
  - Business logic encapsulated in stored procedures

---

## Implemented Pipelines

### `pl_end_to_end_products`
End-to-end orchestration pipeline that:

1. Checks raw data availability
2. Copies raw → curated
3. Cleans and enriches data using Data Flows
4. Loads curated data into SQL staging tables
5. Executes a stored procedure to:
   - Update current product data
   - Insert historical snapshots
6. Ensures idempotent and repeatable executions

---

## Stored Procedures

### `sp_load_products_snapshot`

- Loads data from `stg.products_clean`
- Updates `dbo.products_current` using `MERGE`
- Inserts new rows into `dbo.products_history`
- Supports controlled re-execution:
  - Same-day runs update current data
  - Historical consistency is preserved

---

## Design Principles

- **Separation of concerns**
  - Raw data is never modified
  - Business logic isolated from ingestion

- **Idempotency**
  - Pipelines can be re-run safely
  - Duplicate executions do not corrupt data

- **Scalability**
  - Fully managed Azure services
  - Cloud-native and extensible design

- **Enterprise realism**
  - Mirrors real-world retail and analytics platforms
  - Staging + current + history pattern

- **Observability**
  - Clear pipeline execution paths
  - Fail-fast behavior with explicit error handling

---

## Future Improvements

- Incremental ingestion based on watermarking
- Partitioned storage in Blob and SQL
- Data quality rules (null checks, range checks)
- Analytics layer with Power BI
- Infrastructure as Code (Bicep / Terraform)
- CI/CD for Data Factory and SQL objects

---

## Disclaimer

This project is for **educational and portfolio purposes only**.  
The data used is publicly available and does not contain real production or confidential business information.
